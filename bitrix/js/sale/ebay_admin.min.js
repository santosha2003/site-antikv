(function(e){if(!BX.Sale)BX.Sale={};if(!BX.Sale.EbayAdmin)BX.Sale.EbayAdmin={};BX.Sale.EbayAdmin={ajaxUrl:"/bitrix/admin/sale_ebay_ajax.php",startFeed:function(e,a,t){BX.showWait();var i={action:"startFeed",type:e,siteId:a,sessid:BX.bitrix_sessid()};if(t)i.startPos=t;BX.ajax({timeout:120,method:"POST",dataType:"json",url:BX.Sale.EbayAdmin.ajaxUrl,data:i,onsuccess:function(a){BX.closeWait();if(a&&a.COMPLETED){alert(BX.message("SALE_EBAY_EXCHANGE_OK"))}else if(a&&a.ERROR){alert(BX.message("SALE_EBAY_EXCHANGE_ERROR")+"."+a.ERROR)}else if(a){var t=a.END_ROW||0;BX.Sale.EbayAdmin.startFeed(e,t)}else{alert(BX.message("SALE_EBAY_EXCHANGE_ERROR"))}},onfailure:function(){BX.debug("Feed failure!")}})},addIblockSelect:function(){var e=BX("SALE_EBAY_IBLOCK_CHOOSE").lastElementChild.cloneNode(true);BX("SALE_EBAY_IBLOCK_CHOOSE").appendChild(e);if(e.firstElementChild.options["0"])e.firstElementChild.value="0";e.firstElementChild.name=e.firstElementChild.id=BX.Sale.EbayAdmin.iblockSelectNameIncrement(e.firstElementChild.name);e.firstElementChild.setAttribute("onchange",BX.Sale.EbayAdmin.iblockSelectNameIncrement(e.firstElementChild.getAttribute("onchange")));if(e.firstElementChild.options["0"])e.firstElementChild.value="0";e.lastElementChild.name=e.lastElementChild.id=BX.Sale.EbayAdmin.iblockSelectNameIncrement(e.lastElementChild.name)},iblockSelectNameIncrement:function(e){if(!e||!e.replace)return;return e.replace(/(.*)\[(\d+)\](.*)/,"$1[$21]$3")},refreshCategoriesData:function(e){BX.showWait();var a={action:"refreshCategoriesData",siteId:e,sessid:BX.bitrix_sessid()};BX.ajax({timeout:300,method:"POST",dataType:"json",url:BX.Sale.EbayAdmin.ajaxUrl,data:a,onsuccess:function(e){BX.closeWait();if(e&&e.COUNT){alert("Refreshed "+e.COUNT+" categories.")}else if(e&&e.ERROR){alert(e.ERROR)}else{BX.debug("BX.Sale.EbayAdmin.refreshCategoriesData error!")}},onfailure:function(){BX.debug("BX.Sale.EbayAdmin.refreshCategoriesData failure!")}})},refreshCategoriesPropsData:function(e){BX.showWait();var a={action:"refreshCategoriesPropsData",siteId:e,sessid:BX.bitrix_sessid()};BX.ajax({timeout:120,method:"POST",dataType:"json",url:BX.Sale.EbayAdmin.ajaxUrl,data:a,onsuccess:function(e){BX.closeWait();if(e&&e.COUNT){alert("Refreshed properties for "+e.COUNT+" categories.")}else if(e&&e.ERROR){alert(e.ERROR)}else{BX.debug("BX.Sale.EbayAdmin.refreshCategoriesPropsData error!")}},onfailure:function(){BX.debug("BX.Sale.EbayAdmin.refreshCategoriesPropsData failure!")}})},setOpenerFieldsFromHash:function(a){var t=true,i="{";if(e.location.hash){var r=e.location.hash.substring(1).split("&");for(var n in r){var s=r[n].split("=");if(!s)continue;var o=BX.Sale.EbayAdmin.setOpenerFieldFromHash(s[0],s[1]);t=t&&o;if(i!="{")i+=", ";i+='"'+s[0]+'":"'+s[1]+'"'}}if(i!="{")i+=", ";i+='"messageType":"'+a+'"}';if(parent.window.opener)parent.window.opener.postMessage(i,e.location.origin);e.addEventListener("message",function(a){if(a.data=="MESSAGE_RECEIVED")e.close()},false);return t},setOpenerFieldFromHash:function(e,a){var t="SALE_EBAY_SETTINGS_"+e,i=null,r=false;if(parent.window.opener!==null){try{i=parent.window.opener.document.getElementById(t);r=true}catch(n){}}if(!i)i=BX(t);if(i){a=decodeURIComponent(a);if(i.type=="text")i.value=a;else if(i.type=="textarea")i.value=a}return r},showAlertOpener:function(a){if(parent.window.opener!==null){try{parent.window.opener.alert(a);return true}catch(t){}}e.alert(a);return false},addSftpTokenEventListener:function(a,t){e.addEventListener("message",function(t){if(t.origin==e.location.origin||t.origin=="http://www.1c-bitrix.ru.smn"||t.origin=="https://www.1c-bitrix.ru"){var i=BX("SALE_EBAY_SETTINGS_SFTP_TOKEN"),r=BX("SALE_EBAY_SETTINGS_SFTP_TOKEN_EXP"),n=JSON.parse(t.data);if(!n.messageType||n.messageType!="SFTP_TOKEN")return;if(r&&n.SFTP_TOKEN_EXP)r.value=decodeURIComponent(n.SFTP_TOKEN_EXP);if(i&&n.SFTP_TOKEN)i.value=decodeURIComponent(n.SFTP_TOKEN);if((n.SFTP_ACCOUNT_STATE=="ACTIVE"||n.SFTP_ACCOUNT_STATE=="SUBSCRIBED")&&n.SFTP_TOKEN!=""){alert(a.messageOk);if(a.submit&&r&&r.form)r.form.submit()}else{alert(a.messageError)}t.source.postMessage("MESSAGE_RECEIVED",t.origin)}},false)},addApiTokenListener:function(a){e.addEventListener("message",function(t){if(t.origin==e.location.origin||t.origin=="http://www.1c-bitrix.ru.smn"||t.origin=="http://www.1c-bitrix.ru"){var i=BX("SALE_EBAY_SETTINGS_API_TOKEN"),r=BX("SALE_EBAY_SETTINGS_API_TOKEN_EXP"),n=JSON.parse(t.data);if(!n.messageType||n.messageType!="API_TOKEN")return;if(r&&n.API_TOKEN_EXP)r.value=decodeURIComponent(n.API_TOKEN_EXP);if(i&&n.API_TOKEN){i.value=decodeURIComponent(n.API_TOKEN);t.source.postMessage("MESSAGE_RECEIVED",t.origin);alert(a.messageOk)}else{alert(a.messageError)}}},false)}}})(window);
//# sourceMappingURL=ebay_admin.map.js